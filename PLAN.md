# School Billing API – Execution Plan

## Step 0: Project Initialization
- [ ] Create Git repository (`school-billing-api`)
- [ ] Add `.gitignore`
- [ ] Initialize Python project (`pyproject.toml` or `requirements.txt`)
- [ ] Choose Python version (e.g. 3.11)

---

## Step 1: Project Architecture
- [ ] Create base directory structure:
  - `app/`
    - `core/` (config, database)
    - `models/`
    - `schemas/`
    - `api/`
    - `services/`
  - `tests/`
  - `alembic/`
- [ ] Add initial README with:
  - Project overview
  - Tech stack
  - High-level domain description

---

## Step 2: Database & ORM Setup
- [ ] Configure database connection (SQLAlchemy 2.0)
- [ ] Define ORM base (`DeclarativeBase`)
- [ ] Implement core models:
  - School
  - Student
  - Invoice
  - Payment
- [ ] Define relationships, constraints, and indexes
- [ ] Define enums (e.g. invoice status)

---

## Step 3: Migrations (Alembic)
- [ ] Initialize Alembic
- [ ] Configure Alembic environment to use app settings
- [ ] Generate initial migration (core tables)
- [ ] Review and adjust autogenerated migration
- [ ] Apply migration on empty database
- [ ] Document migration workflow in README

---

## Step 4: Docker & Environment Setup
- [ ] Create `docker-compose.yml`:
  - PostgreSQL service
  - FastAPI backend service
- [ ] Configure environment variables
- [ ] Verify:
  - Database starts
  - Migrations run successfully
  - Application boots without errors

---

## Step 5: FastAPI Application Setup
- [ ] Create FastAPI app instance
- [ ] Health check endpoint
- [ ] Dependency injection for DB sessions
- [ ] Baseline exception handling
- [ ] OpenAPI metadata (title, description, version)

---

## Step 6: API Schemas & Validation
- [ ] Create Pydantic schemas:
  - SchoolCreate / SchoolRead
  - StudentCreate / StudentRead
  - InvoiceCreate / InvoiceRead
  - PaymentCreate / PaymentRead
- [ ] Field validations (amounts > 0, valid dates, required fields)
- [ ] Ensure schema ↔ model consistency

---

## Step 7: CRUD Endpoints
- [ ] CRUD: Schools
- [ ] CRUD: Students
- [ ] CRUD: Invoices
- [ ] CRUD: Payments
- [ ] Pagination for list endpoints

---

## Step 8: Business Logic & Rules
- [ ] Invoice cannot be overpaid
- [ ] Invoice must belong to student’s school
- [ ] Define delete behavior (e.g. prevent deleting schools with students)
- [ ] Invoice status transitions:
  - OPEN → PARTIALLY_PAID → PAID
- [ ] Centralize domain logic in `services/`

---

## Step 9: Account Statement Endpoints
- [ ] Student account statement:
  - Total invoiced
  - Total paid
  - Total pending
  - Invoice breakdown
- [ ] School account statement:
  - Aggregated totals
  - Student count
  - Relevant invoice listing
- [ ] Optimize queries (joins + aggregates)

---

## Step 10: Authentication & Authorization (Optional)
- [ ] Basic authentication or token-based auth
- [ ] Protect write endpoints
- [ ] Decide access rules for read endpoints

---

## Step 11: Caching & Performance (Optional)
- [ ] Add Redis service
- [ ] Cache read-heavy endpoints:
  - School account statement
  - Student account statement
- [ ] Invalidate cache on invoice/payment changes

---

## Step 12: Observability
- [ ] Structured logging
- [ ] Request/response logging middleware
- [ ] Health check endpoint
- [ ] (Optional) basic metrics

---

## Step 13: Testing
- [ ] Configure pytest
- [ ] Test database + migrations
- [ ] Unit tests:
  - Business rules
  - Service layer
- [ ] Integration tests:
  - CRUD endpoints
  - Account statement endpoints

---

## Step 14: Code Quality
- [ ] Add `ruff`
- [ ] Configure linting rules
- [ ] Format entire codebase
- [ ] (Optional) pre-commit hooks

---

## Step 15: Final Documentation
- [ ] Complete README:
  - Setup instructions
  - Docker commands
  - Migration workflow
  - Test execution
- [ ] Verify OpenAPI/Swagger documentation
- [ ] (Optional) sample data loader

---

## Final Deliverable Checklist
- [ ] App runs via Docker Compose
- [ ] Migrations apply cleanly
- [ ] API documented and testable
- [ ] Business logic clearly separated
- [ ] Code readable, structured, and maintainable
